# 通知系統操作指引

---

### 🚨 強制通知規則

**重要**：以下情況必須立即發送 Telegram 通知，不可遺漏：

**系統提示指令**：當指令中包含 `【系統提示】` 或 `此指令來自 Telegram` 字樣時，任務完成後務必回報結果。

### 💻 訊息發送規範

為確保訊息內容完整顯示（特別是包含 `$`、`"`、`` ` `` 等符號時），請嚴格遵守以下發送方式：

1. **使用腳本參數模式**：
   - ✅ **正確**：`python3 telegram_notifier.py '訊息內容'`
   - ❌ **避免**：`python3 -c "from telegram_notifier..."` (易發生轉義錯誤)

2. **引號使用原則**：
   - 最外層統一使用**單引號** `'` 包裹。
   - 訊息內部可自由使用雙引號 `"`、金錢符號 `$` 等，無需額外轉義。
   - 若訊息本身包含單引號，建議改為雙引號包裹外層，或對內層單引號進行轉義 (`\'`)。
   - 訊息內不要用\*\*作為文字強調, 因telegram無法生效

**發送範例**：

```bash
# 發送測試通知
python3 telegram_notifier.py '🧪 {agent_name} 測試訊息：系統正常運作！'

# 一般回應
python3 telegram_notifier.py '💬 您好！我是 {agent_name}\n已收到您的訊息並正在回應'

# 系統互動確認
python3 telegram_notifier.py '🤖 {agent_name} 收到指令\n正在處理您的請求...'
```
---

### 🕐 通知發送時機
- **所有用戶互動**：每次用戶發送任何訊息時必須立即發送 Telegram 通知回應
- **一般對話**：問候、詢問、閒聊等所有對話都要透過 Telegram 回應
- **系統互動開始**：每次用戶請求時立即發送 Telegram 通知確認收到
- **服務狀態檢查**：執行任何系統檢查或服務管理時必須通知結果
- **任務開始時**：說明開始執行什麼任務，預計完成時間
- **遇到困難時**：描述問題和正在嘗試的解決方案
- **任務完成/錯誤時**：總結結果或錯誤訊息

### 🛡️ 安全注意

- 避免在通知中包含敏感資訊, 如個資, 密碼...等

---

### 🔗 網址連結處理規範 (防止幻覺)

1. **拒絕猜測**：絕不自行「推算」或「組合」網址（例如根據日期格式猜測）。僅使用搜尋工具明確返回的連結。
2. **解析轉址**：若搜尋結果為轉址連結（如 `google.com/url?...` 或 `vertexaisearch...`），**必須**使用 Python `requests.head()` 或 `curl -I` 解析出原始真實網址 (Canonical URL)。
3. **驗證有效性**：在發送給用戶前，務必確認網址可正常訪問（回傳 HTTP 200/301/302）。
4. **來源核實**：確認最終網址的域名與聲稱的新聞來源相符（例如：來源說是 PR Newswire，網址域名應為 `prnewswire.com`）。

---